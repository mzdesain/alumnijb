<!doctype html>
<html lang="id">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alumni Pontren Jamaluddin Bagik Nyaka</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"><!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      height: 100%;
      background-color: #f0f4f8;
    }
    html {
      height: 100%;
    }
    .sidebar {
      transition: all 0.3s;
      box-shadow: 2px 0 10px rgba(0,0,0,0.1);
      background-color: #ffffff;
    }
    .menu-item {
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 500;
      color: #1f2937;
    }
    .menu-item:hover {
      transform: translateX(5px);
    }
    .menu-item.active {
      background-color: #3b82f6;
      color: #ffffff;
    }
    .menu-item i {
      width: 20px;
      text-align: center;
    }
    .content-card {
      animation: fadeIn 0.3s;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .stat-card {
      border-radius: 16px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.07);
      transition: transform 0.2s, box-shadow 0.2s;
      background-color: #ffffff;
    }
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 15px rgba(0,0,0,0.12);
    }
    .table-modern {
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      background-color: #ffffff;
    }
    .btn-modern {
      border-radius: 10px;
      font-weight: 600;
      transition: all 0.2s;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .btn-modern:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    .btn-modern:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .modal-backdrop {
      backdrop-filter: blur(4px);
    }
    .logo-placeholder {
      width: 20px;
      height: 20px;
      background-color: #f0f4f8;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #3b82f6;
      font-size: 12px;
      text-align: center;
      line-height: 1.2;
      padding: 4px;
      border: 2px dashed #3b82f6;
    }

    /* Mobile Responsive Styles */
    .mobile-header {
      display: none;
      background-color: #ffffff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 16px;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .hamburger {
      width: 30px;
      height: 24px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      cursor: pointer;
      padding: 4px;
    }
    .hamburger span {
      display: block;
      height: 3px;
      background-color: #3b82f6;
      border-radius: 2px;
      transition: all 0.3s;
    }
    .hamburger.active span:nth-child(1) {
      transform: translateY(10px) rotate(45deg);
    }
    .hamburger.active span:nth-child(2) {
      opacity: 0;
    }
    .hamburger.active span:nth-child(3) {
      transform: translateY(-11px) rotate(-45deg);
    }
    
    @media (max-width: 768px) {
      .mobile-header {
        display: flex;
        align-items: center;
        gap: 16px;
      }
      .sidebar {
        position: fixed;
        left: -100%;
        top: 0;
        height: 100%;
        z-index: 200;
        width: 280px;
        overflow-y: auto;
      }
      .sidebar.open {
        left: 0;
      }
      .sidebar-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0,0,0,0.5);
        z-index: 150;
      }
      .sidebar-overlay.show {
        display: block;
      }
      #app {
        display: block;
      }
      .content-wrapper {
        width: 100%;
      }
      .table-modern {
        overflow-x: auto;
      }
      .stat-card {
        margin-bottom: 16px;
      }
      .mobile-header .logo-placeholder {
        width: 40px;
        height: 40px;
        font-size: 10px;
      }
    }

    /* Floating Chat Button */
    .floating-chat-btn {
      position: fixed;
      bottom: 24px;
      right: 24px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background-color: #3b82f6;
      color: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
      cursor: pointer;
      transition: all 0.3s;
      z-index: 900;
      font-size: 20px;
    }
    .floating-chat-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 16px rgba(59, 130, 246, 0.5);
    }
    .chat-modal {
      position: fixed;
      bottom: 90px;
      right: 24px;
      width: 350px;
      max-width: calc(100vw - 48px);
      background-color: #ffffff;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
      z-index: 950;
      display: none;
      animation: slideUp 0.3s ease-out;
    }
    .chat-modal.show {
      display: block;
    }
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    @media (max-width: 768px) {
      .floating-chat-btn {
        width: 50px;
        height: 50px;
        bottom: 20px;
        right: 20px;
        font-size: 18px;
      }
      .chat-modal {
        bottom: 80px;
        right: 20px;
        width: calc(100vw - 40px);
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body><!-- Mobile Header with Hamburger -->
  <div class="mobile-header">
   <div class="hamburger" id="hamburgerBtn"><span></span> <span></span> <span></span>
   </div>
   <div class="flex items-center gap-3">
    <h1 class="text-lg font-bold" style="color: #1f2937;">Sistem Alumni</h1>
   </div>
  </div><!-- Sidebar Overlay (Mobile) -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>
  <div id="app" class="flex h-full"><!-- Sidebar -->
   <div class="sidebar w-64 shadow-lg" id="sidebar">
    <div class="p-6">
     <div class="mb-8 flex justify-center"><img src="LOGO PONDOK.png" alt="Logo Alumni" style="max-width: 85px; height: auto;">
     </div>
     <nav><a href="#" class="menu-item py-3 px-4 rounded-lg mb-2" data-page="beranda"> <i class="fa fa-chart-line"></i> <span>Beranda</span> </a> <a href="#" class="menu-item py-3 px-4 rounded-lg mb-2" data-page="alumni"> <i class="fa fa-users"></i> <span>Alumni</span> </a> <a href="#" class="menu-item py-3 px-4 rounded-lg mb-2" data-page="pendidikan"> <i class="fa fa-user-graduate"></i> <span>Pendidikan Terakhir</span> </a> <a href="#" class="menu-item py-3 px-4 rounded-lg mb-2" data-page="iuran"> <i class="fa fa-money-bill-wave"></i> <span>Iuran</span> </a> <a href="#" class="menu-item py-3 px-4 rounded-lg mb-2" data-page="whatsapp"> <i class="fab fa-whatsapp"></i> <span>Group WhatsApp</span> </a> <a href="#" class="menu-item py-3 px-4 rounded-lg mb-2" data-page="tugas"> <i class="fa fa-tasks"></i> <span>Tugas | Pengabdian</span> </a> <a href="#" class="menu-item py-3 px-4 rounded-lg mb-2" data-page="pesan-masuk" id="menuPesanMasuk" style="display: none;"> <i class="fa fa-envelope"></i> <span>Pesan Masuk</span> </a>
      <div class="border-t mt-4 pt-4"><a href="#" class="menu-item py-3 px-4 rounded-lg mb-2" data-page="form-daftar" style="background-color: rgba(16, 185, 129, 0.1);"> <i class="fa fa-edit"></i> <span>Form Pendaftaran</span> </a> <a href="#" class="menu-item py-3 px-4 rounded-lg" id="loginBtn"> <i class="fa fa-lock"></i> <span>Login Admin</span> </a>
      </div>
     </nav>
    </div>
   </div><!-- Main Content -->
   <div class="flex-1 overflow-y-auto content-wrapper" style="display: flex; flex-direction: column; min-height: 100%;">
    <div class="p-8 flex-1" id="mainContent"><!-- Content will be loaded here -->
    </div>
    <footer class="text-center py-6 px-4" style="background-color: #ffffff; border-top: 2px solid #e5e7eb; margin-top: auto;">
     <p class="font-bold text-sm mb-2" style="color: #1f2937;">Alumni Pontren Jamaluddin Bagik Nyaka</p>
     <p class="text-xs" style="color: #6b7280;">Created by <a href="https://www.instagram.com/muzanni.uce/" target="_blank" rel="noopener noreferrer" class="font-semibold hover:underline" style="color: #3b82f6; cursor: pointer;">Muzanni</a></p>
    </footer>
   </div>
  </div><!-- Floating Chat Button -->
  <div class="floating-chat-btn" id="floatingChatBtn"><i class="fa fa-comment-dots"></i>
  </div><!-- Chat Modal -->
  <div class="chat-modal" id="chatModal">
   <div class="p-5">
    <div class="flex items-center justify-between mb-4">
     <h3 class="font-bold text-lg" style="color: #1f2937;"><i class="fa fa-paper-plane mr-2" style="color: #3b82f6;"></i>Kirim Saran</h3><button id="closeChatModal" class="text-2xl" style="color: #6b7280; cursor: pointer;"> <i class="fa fa-times"></i> </button>
    </div>
    <form id="chatForm">
     <div class="mb-3"><label class="block mb-2 font-semibold text-sm" style="color: #1f2937;">Nama Anda</label> <input type="text" name="nama" class="w-full px-3 py-2 border-2 rounded-lg focus:outline-none text-sm" placeholder="Masukkan nama lengkap" required style="border-color: #e5e7eb;">
     </div>
     <div class="mb-3"><label class="block mb-2 font-semibold text-sm" style="color: #1f2937;">Alumni Tahun</label> <input type="text" name="tahun" class="w-full px-3 py-2 border-2 rounded-lg focus:outline-none text-sm" placeholder="Contoh: 2021" required style="border-color: #e5e7eb;">
     </div>
     <div class="mb-4"><label class="block mb-2 font-semibold text-sm" style="color: #1f2937;">Isi Pesan (Saran)</label> <textarea name="pesan" rows="4" class="w-full px-3 py-2 border-2 rounded-lg focus:outline-none text-sm resize-none" placeholder="Tuliskan saran Anda..." required style="border-color: #e5e7eb;"></textarea>
     </div><button type="submit" class="btn-modern w-full py-2 font-semibold text-sm flex items-center justify-center gap-2" style="background-color: #3b82f6; color: #ffffff;"> <i class="fa fa-paper-plane"></i> <span>Kirim Pesan</span> </button>
    </form>
   </div>
  </div><!-- Login Modal -->
  <div id="loginModal" class="modal-backdrop fixed inset-0 flex items-center justify-center hidden" style="background-color: rgba(0,0,0,0.6); z-index: 1000;">
   <div class="rounded-2xl shadow-2xl p-10 max-w-md w-full mx-4" style="background-color: #ffffff;">
    <div class="text-center mb-8">
     <div class="inline-flex items-center justify-center w-20 h-20 rounded-full mb-4" style="background-color: rgba(59, 130, 246, 0.1);"><i class="fa fa-lock text-4xl" style="color: #3b82f6;"></i>
     </div>
     <h2 class="text-3xl font-bold mb-2" style="color: #1f2937;">Login Admin</h2>
     <p class="text-sm" style="color: #6b7280;">Form Login Khusus Admin</p>
    </div>
    <form id="loginForm">
     <div class="mb-5"><label for="username" class="block mb-2 font-semibold text-sm" style="color: #374151;"> <i class="fa fa-user mr-2" style="color: #3b82f6;"></i> Username </label> <input type="text" id="username" class="w-full px-4 py-3 border-2 rounded-xl focus:outline-none transition-all" placeholder="Masukkan username" required style="border-color: #e5e7eb; background-color: #f9fafb;" onfocus="this.style.borderColor='#3b82f6'; this.style.backgroundColor='#ffffff';" onblur="this.style.borderColor='#e5e7eb'; this.style.backgroundColor='#f9fafb';">
     </div>
     <div class="mb-6"><label for="password" class="block mb-2 font-semibold text-sm" style="color: #374151;"> <i class="fa fa-key mr-2" style="color: #3b82f6;"></i> Password </label> <input type="password" id="password" class="w-full px-4 py-3 border-2 rounded-xl focus:outline-none transition-all" placeholder="Masukkan password" required style="border-color: #e5e7eb; background-color: #f9fafb;" onfocus="this.style.borderColor='#3b82f6'; this.style.backgroundColor='#ffffff';" onblur="this.style.borderColor='#e5e7eb'; this.style.backgroundColor='#f9fafb';">
     </div>
     <div class="flex gap-3"><button type="submit" class="btn-modern flex-1 py-3 px-6 font-bold text-base rounded-xl" style="background-color: #3b82f6; color: #ffffff;"> <i class="fa fa-sign-in-alt mr-2"></i>Masuk </button> <button type="button" id="cancelLogin" class="btn-modern flex-1 py-3 px-6 font-semibold text-base rounded-xl" style="background-color: #f3f4f6; color: #6b7280;"> <i class="fa fa-times mr-2"></i>Batal </button>
     </div>
     <p id="loginError" class="mt-4 p-3 text-sm hidden text-center rounded-lg font-medium" style="background-color: #fee2e2; color: #dc2626;"></p>
    </form>
   </div>
  </div>
  <script>
    // ========================================
    // FIREBASE CONFIGURATION
    // ========================================
    const firebaseConfig = {
      apiKey: "AIzaSyD2EJdvk7_mpXn_e3IE3r8uS8CfahxlKJI",
      authDomain: "alumnijb.firebaseapp.com",
      projectId: "alumnijb",
      storageBucket: "alumnijb.firebasestorage.app",
      messagingSenderId: "1058978961953",
      appId: "1:1058978961953:web:ceafd257f7cd47a5960de1",
      measurementId: "G-MN5D90P346"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const alumniCollection = db.collection('alumni');
    const pesanCollection = db.collection('pesan');

    // ========================================
    // STATE MANAGEMENT
    // ========================================
    let alumniData = [];
    let pesanData = [];
    let isAdmin = false;
    let currentPage = 'beranda';
    let unsubscribe = null;
    let unsubscribePesan = null;

    // ========================================
    // MOBILE MENU FUNCTIONS
    // ========================================
    const hamburgerBtn = document.getElementById('hamburgerBtn');
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebarOverlay');

    function toggleSidebar() {
      sidebar.classList.toggle('open');
      sidebarOverlay.classList.toggle('show');
      hamburgerBtn.classList.toggle('active');
    }

    function closeSidebar() {
      sidebar.classList.remove('open');
      sidebarOverlay.classList.remove('show');
      hamburgerBtn.classList.remove('active');
    }

    if (hamburgerBtn) {
      hamburgerBtn.addEventListener('click', toggleSidebar);
    }

    if (sidebarOverlay) {
      sidebarOverlay.addEventListener('click', closeSidebar);
    }

    // ========================================
    // FIREBASE FUNCTIONS
    // ========================================
    
    // Real-time listener untuk data alumni
    function subscribeToAlumni() {
      unsubscribe = alumniCollection.onSnapshot((snapshot) => {
        alumniData = [];
        snapshot.forEach((doc) => {
          alumniData.push({
            id: doc.id,
            ...doc.data()
          });
        });
        // Sort by created_at descending
        alumniData.sort((a, b) => {
          const dateA = a.created_at ? new Date(a.created_at) : new Date(0);
          const dateB = b.created_at ? new Date(b.created_at) : new Date(0);
          return dateB - dateA;
        });
        loadPage(currentPage);
      }, (error) => {
        console.error("Error fetching alumni:", error);
        showToast('Gagal memuat data dari Firebase', 'error');
      });
    }

    // Tambah alumni baru
    async function addAlumni(alumniObj) {
      try {
        await alumniCollection.add(alumniObj);
        return { success: true };
      } catch (error) {
        console.error("Error adding alumni:", error);
        return { success: false, error: error.message };
      }
    }

    // Update alumni
    async function updateAlumni(id, updates) {
      try {
        await alumniCollection.doc(id).update(updates);
        return { success: true };
      } catch (error) {
        console.error("Error updating alumni:", error);
        return { success: false, error: error.message };
      }
    }

    // Hapus alumni
    async function deleteAlumni(id) {
      try {
        await alumniCollection.doc(id).delete();
        return { success: true };
      } catch (error) {
        console.error("Error deleting alumni:", error);
        return { success: false, error: error.message };
      }
    }

    // Real-time listener untuk pesan masuk
    function subscribeToPesan() {
      unsubscribePesan = pesanCollection.onSnapshot((snapshot) => {
        pesanData = [];
        snapshot.forEach((doc) => {
          pesanData.push({
            id: doc.id,
            ...doc.data()
          });
        });
        // Sort by created_at descending
        pesanData.sort((a, b) => {
          const dateA = a.created_at ? new Date(a.created_at) : new Date(0);
          const dateB = b.created_at ? new Date(b.created_at) : new Date(0);
          return dateB - dateA;
        });
        if (currentPage === 'pesan-masuk') {
          loadPage('pesan-masuk');
        }
      }, (error) => {
        console.error("Error fetching pesan:", error);
      });
    }

    // Tambah pesan baru
    async function addPesan(pesanObj) {
      try {
        await pesanCollection.add(pesanObj);
        return { success: true };
      } catch (error) {
        console.error("Error adding pesan:", error);
        return { success: false, error: error.message };
      }
    }

    // Hapus pesan
    async function deletePesan(id) {
      try {
        await pesanCollection.doc(id).delete();
        return { success: true };
      } catch (error) {
        console.error("Error deleting pesan:", error);
        return { success: false, error: error.message };
      }
    }

    // ========================================
    // UI FUNCTIONS
    // ========================================

    // Toast notification
    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = 'fixed bottom-8 right-8 px-6 py-3 rounded-lg shadow-lg transition-all';
      toast.style.backgroundColor = type === 'success' ? '#10b981' : '#ef4444';
      toast.style.color = '#ffffff';
      toast.style.zIndex = '2000';
      toast.innerHTML = message;
      document.body.appendChild(toast);
      setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // Set active menu
    function setActiveMenu(page) {
      document.querySelectorAll('.menu-item').forEach(item => {
        item.classList.remove('active');
      });
      const activeItem = document.querySelector(`.menu-item[data-page="${page}"]`);
      if (activeItem) {
        activeItem.classList.add('active');
      }
    }

    // ========================================
    // PAGE RENDERING
    // ========================================

    function loadPage(page) {
      currentPage = page;
      const content = document.getElementById('mainContent');
      setActiveMenu(page);
      closeSidebar(); // Close sidebar on mobile when page changes
      
      switch(page) {
        case 'beranda':
          renderBeranda(content);
          break;
        case 'alumni':
          renderAlumni(content);
          break;
        case 'pendidikan':
          renderPendidikan(content);
          break;
        case 'iuran':
          renderIuran(content);
          break;
        case 'whatsapp':
          renderWhatsApp(content);
          break;
        case 'tugas':
          renderTugas(content);
          break;
        case 'pesan-masuk':
          renderPesanMasuk(content);
          break;
        case 'form-daftar':
          renderFormDaftar(content);
          break;
      }
    }

    function renderBeranda(content) {
      const totalAlumni = alumniData.length;
      const melanjutkanPendidikan = alumniData.filter(a => a.kelanjutan_pendidikan && a.kelanjutan_pendidikan !== '-').length;
      const iuranLunas = alumniData.filter(a => a.iuran_status === 'Lunas').length;

      content.innerHTML = `
        <div class="content-card">
          <h2 class="text-3xl font-bold mb-6" style="color: #1f2937;"></h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="stat-card p-6">
              <div class="flex items-center justify-between">
                <div>
                  <div class="text-sm font-medium mb-2" style="color: #6b7280;">Total Alumni</div>
                  <div class="text-4xl font-bold" style="color: #3b82f6;">${totalAlumni}</div>
                </div>
                <div class="text-5xl" style="color: #3b82f6; opacity: 0.2;">
                  <i class="fa fa-users"></i>
                </div>
              </div>
            </div>
            <div class="stat-card p-6">
              <div class="flex items-center justify-between">
                <div>
                  <div class="text-sm font-medium mb-2" style="color: #6b7280;">Melanjutkan Pendidikan</div>
                  <div class="text-4xl font-bold" style="color: #3b82f6;">${melanjutkanPendidikan}</div>
                </div>
                <div class="text-5xl" style="color: #3b82f6; opacity: 0.2;">
                  <i class="fa fa-user-graduate"></i>
                </div>
              </div>
            </div>
            <div class="stat-card p-6">
              <div class="flex items-center justify-between">
                <div>
                  <div class="text-sm font-medium mb-2" style="color: #6b7280;">Iuran Lunas</div>
                  <div class="text-4xl font-bold" style="color: #3b82f6;">${iuranLunas}</div>
                </div>
                <div class="text-5xl" style="color: #3b82f6; opacity: 0.2;">
                  <i class="fa fa-check-circle"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderAlumni(content) {
      let html = `
        <div class="content-card">
          <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
            <h2 class="text-2xl md:text-3xl font-bold" style="color: #1f2937;"></h2>
            ${isAdmin ? '<button id="addAlumniBtn" class="btn-modern px-6 py-3 w-full md:w-auto" style="background-color: #3b82f6; color: #ffffff;"><i class="fa fa-user-plus mr-2"></i>Tambah Alumni</button>' : ''}
          </div>
          <div class="table-modern overflow-x-auto">
            <table class="w-full">
              <thead style="background-color: #3b82f6; color: #ffffff;">
                <tr>
                  <th class="px-4 md:px-6 py-4 text-left font-semibold text-sm md:text-base">Nama</th>
                  <th class="px-4 md:px-6 py-4 text-left font-semibold text-sm md:text-base">Jenis Kelamin</th>
                  <th class="px-4 md:px-6 py-4 text-left font-semibold text-sm md:text-base">Tahun Masuk</th>
                  <th class="px-4 md:px-6 py-4 text-left font-semibold text-sm md:text-base">Tahun Lulus</th>
                  ${isAdmin ? '<th class="px-4 md:px-6 py-4 text-left font-semibold text-sm md:text-base">Aksi</th>' : ''}
                </tr>
              </thead>
              <tbody>
      `;
      
      if (alumniData.length === 0) {
        html += `
          <tr>
            <td colspan="${isAdmin ? 5 : 4}" class="px-6 py-8 text-center" style="color: #6b7280;">
              <i class="fa fa-inbox text-4xl mb-3" style="display: block;"></i>
              Belum ada data alumni
            </td>
          </tr>
        `;
      } else {
        alumniData.forEach((alumni) => {
          html += `
            <tr style="border-bottom: 1px solid rgba(0,0,0,0.05);">
              <td class="px-4 md:px-6 py-4 text-sm md:text-base" style="color: #1f2937;">${alumni.nama}</td>
              <td class="px-4 md:px-6 py-4 text-sm md:text-base" style="color: #1f2937;">${alumni.jenis_kelamin || '-'}</td>
              <td class="px-4 md:px-6 py-4 text-sm md:text-base" style="color: #1f2937;">${alumni.tahun_masuk}</td>
              <td class="px-4 md:px-6 py-4 text-sm md:text-base" style="color: #1f2937;">${alumni.tahun_lulus}</td>
              ${isAdmin ? `<td class="px-4 md:px-6 py-4"><button class="deleteAlumniBtn btn-modern px-3 py-2 text-xs md:text-sm" style="background-color: #ef4444; color: #ffffff;" data-id="${alumni.id}"><i class="fa fa-trash mr-1"></i>Hapus</button></td>` : ''}
            </tr>
          `;
        });
      }
      
      html += `
              </tbody>
            </table>
          </div>
        </div>
      `;
      
      content.innerHTML = html;
      
      if (isAdmin) {
        const addBtn = document.getElementById('addAlumniBtn');
        if (addBtn) {
          addBtn.addEventListener('click', showAlumniForm);
        }
        
        document.querySelectorAll('.deleteAlumniBtn').forEach(btn => {
          btn.addEventListener('click', async (e) => {
            const button = e.currentTarget;
            const id = button.getAttribute('data-id');
            
            button.disabled = true;
            button.innerHTML = '<i class="fa fa-spinner fa-spin mr-1"></i>Menghapus...';
            
            const result = await deleteAlumni(id);
            
            if (result.success) {
              showToast('Alumni berhasil dihapus');
            } else {
              showToast('Gagal menghapus alumni', 'error');
              button.disabled = false;
              button.innerHTML = '<i class="fa fa-trash mr-1"></i>Hapus';
            }
          });
        });
      }
    }

    function renderPendidikan(content) {
      let html = `
        <div class="content-card">
          <h2 class="text-2xl md:text-3xl font-bold mb-6" style="color: #1f2937;"></h2>
          <div class="table-modern overflow-x-auto">
            <table class="w-full">
              <thead style="background-color: #3b82f6; color: #ffffff;">
                <tr>
                  <th class="px-4 md:px-6 py-4 text-left font-semibold text-sm md:text-base">Nama</th>
                  <th class="px-4 md:px-6 py-4 text-left font-semibold text-sm md:text-base">Pendidikan Terakhir</th>
                </tr>
              </thead>
              <tbody>
      `;
      
      if (alumniData.length === 0) {
        html += `
          <tr>
            <td colspan="2" class="px-6 py-8 text-center" style="color: #6b7280;">
              <i class="fa fa-inbox text-4xl mb-3" style="display: block;"></i>
              Belum ada data
            </td>
          </tr>
        `;
      } else {
        alumniData.forEach((alumni) => {
          html += `
            <tr style="border-bottom: 1px solid rgba(0,0,0,0.05);">
              <td class="px-4 md:px-6 py-4 text-sm md:text-base" style="color: #1f2937;">${alumni.nama}</td>
              <td class="px-4 md:px-6 py-4 text-sm md:text-base" style="color: #1f2937;">${alumni.kelanjutan_pendidikan || '-'}</td>
            </tr>
          `;
        });
      }
      
      html += `
              </tbody>
            </table>
          </div>
        </div>
      `;
      
      content.innerHTML = html;
    }

    function renderIuran(content) {
      // Hanya alumni yang bisa lihat halaman iuran
      if (!isAdmin) {
        content.innerHTML = `
          <div class="content-card text-center py-16">
            <div class="inline-flex items-center justify-center w-24 h-24 rounded-full mb-6" style="background-color: rgba(239, 68, 68, 0.1);">
              <i class="fa fa-lock text-5xl" style="color: #ef4444;"></i>
            </div>
            <h2 class="text-3xl font-bold mb-4" style="color: #1f2937;">Akses Terbatas</h2>
            <p class="text-lg mb-6" style="color: #6b7280;">Halaman ini hanya dapat diakses oleh alumni yang sudah login sebagai admin.</p>
            <button onclick="document.getElementById('loginBtn').click()" class="btn-modern px-8 py-3 inline-flex items-center gap-2" style="background-color: #3b82f6; color: #ffffff;">
              <i class="fa fa-lock"></i>
              <span>Login Admin</span>
            </button>
          </div>
        `;
        return;
      }

      let html = `
        <div class="content-card">
          <h2 class="text-2xl md:text-3xl font-bold mb-6" style="color: #1f2937;"></h2>
          <div class="table-modern overflow-x-auto">
            <table class="w-full">
              <thead style="background-color: #3b82f6; color: #ffffff;">
                <tr>
                  <th class="px-4 md:px-6 py-4 text-left font-semibold text-sm md:text-base">Nama</th>
                  <th class="px-4 md:px-6 py-4 text-left font-semibold text-sm md:text-base">Status Iuran</th>
                  <th class="px-4 md:px-6 py-4 text-center font-semibold text-sm md:text-base">Sudah Bayar</th>
                </tr>
              </thead>
              <tbody>
      `;
      
      if (alumniData.length === 0) {
        html += `
          <tr>
            <td colspan="3" class="px-6 py-8 text-center" style="color: #6b7280;">
              <i class="fa fa-inbox text-4xl mb-3" style="display: block;"></i>
              Belum ada data
            </td>
          </tr>
        `;
      } else {
        alumniData.forEach((alumni) => {
          const statusColor = alumni.iuran_status === 'Lunas' ? '#10b981' : '#ef4444';
          const statusIcon = alumni.iuran_status === 'Lunas' ? 'fa-check-circle' : 'fa-times-circle';
          const isChecked = alumni.iuran_status === 'Lunas' ? 'checked' : '';
          
          html += `
            <tr style="border-bottom: 1px solid rgba(0,0,0,0.05);">
              <td class="px-4 md:px-6 py-4 text-sm md:text-base" style="color: #1f2937;">${alumni.nama}</td>
              <td class="px-4 md:px-6 py-4"><span class="px-3 py-2 rounded-lg text-white text-xs md:text-sm font-semibold inline-flex items-center gap-2" style="background-color: ${statusColor};"><i class="fa ${statusIcon}"></i>${alumni.iuran_status || 'Belum Bayar'}</span></td>
              <td class="px-4 md:px-6 py-4 text-center"><input type="checkbox" class="iuran-checkbox w-5 h-5 cursor-pointer" data-id="${alumni.id}" ${isChecked} style="accent-color: #10b981;"></td>
            </tr>
          `;
        });
      }
      
      html += `
              </tbody>
            </table>
          </div>
        </div>
      `;
      
      content.innerHTML = html;
      
      document.querySelectorAll('.iuran-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', async (e) => {
          const id = e.currentTarget.getAttribute('data-id');
          const checked = e.currentTarget.checked;
          
          e.currentTarget.disabled = true;
          
          const result = await updateAlumni(id, {
            iuran_status: checked ? 'Lunas' : 'Belum Bayar'
          });
          
          if (result.success) {
            showToast(checked ? 'Status diubah menjadi Lunas' : 'Status diubah menjadi Belum Bayar');
          } else {
            showToast('Gagal mengubah status', 'error');
            e.currentTarget.checked = !checked;
          }
          
          e.currentTarget.disabled = false;
        });
      });
    }

    function renderWhatsApp(content) {
      content.innerHTML = `
        <div class="content-card">
          <h2 class="text-2xl md:text-3xl font-bold mb-6" style="color: #1f2937;"></h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="stat-card p-8 text-center">
              <div class="text-6xl mb-4" style="color: #25D366;">
                <i class="fab fa-whatsapp"></i>
              </div>
              <h3 class="text-xl font-bold mb-3" style="color: #1f2937;">Group Ikhwah</h3>
              <p class="mb-4" style="color: #6b7280;">Bergabunglah dengan group alumni laki-laki</p>
              <a href="https://chat.whatsapp.com/cewek" target="_blank" rel="noopener noreferrer" class="btn-modern inline-flex items-center gap-2 px-6 py-3" style="background-color: #25D366; color: #ffffff;"><i class="fab fa-whatsapp"></i>Gabung Group</a>
            </div>
            <div class="stat-card p-8 text-center">
              <div class="text-6xl mb-4" style="color: #25D366;">
                <i class="fab fa-whatsapp"></i>
              </div>
              <h3 class="text-xl font-bold mb-3" style="color: #1f2937;">Group Akhwat</h3>
              <p class="mb-4" style="color: #6b7280;">Bergabunglah dengan group alumni perempuan</p>
              <a href="https://chat.whatsapp.com/cowok" target="_blank" rel="noopener noreferrer" class="btn-modern inline-flex items-center gap-2 px-6 py-3" style="background-color: #25D366; color: #ffffff;"><i class="fab fa-whatsapp"></i>Gabung Group</a>
            </div>
          </div>
        </div>
      `;
    }

    function renderTugas(content) {
      let html = `
        <div class="content-card">
          <h2 class="text-2xl md:text-3xl font-bold mb-6" style="color: #1f2937;"></h2>
          <div class="table-modern overflow-x-auto">
            <table class="w-full">
              <thead style="background-color: #3b82f6; color: #ffffff;">
                <tr>
                  <th class="px-4 md:px-6 py-4 text-left font-semibold text-sm md:text-base">Nama</th>
                  <th class="px-4 md:px-6 py-4 text-left font-semibold text-sm md:text-base">Tugas</th>
                </tr>
              </thead>
              <tbody>
      `;
      
      if (alumniData.length === 0) {
        html += `
          <tr>
            <td colspan="2" class="px-6 py-8 text-center" style="color: #6b7280;">
              <i class="fa fa-inbox text-4xl mb-3" style="display: block;"></i>
              Belum ada data
            </td>
          </tr>
        `;
      } else {
        alumniData.forEach((alumni) => {
          html += `
            <tr style="border-bottom: 1px solid rgba(0,0,0,0.05);">
              <td class="px-4 md:px-6 py-4 text-sm md:text-base" style="color: #1f2937;">${alumni.nama}</td>
              <td class="px-4 md:px-6 py-4 text-sm md:text-base" style="color: #1f2937;">${alumni.tugas || '-'}</td>
            </tr>
          `;
        });
      }
      
      html += `
              </tbody>
            </table>
          </div>
        </div>
      `;
      
      content.innerHTML = html;
    }

    function renderPesanMasuk(content) {
      let html = `
        <div class="content-card">
          <h2 class="text-2xl md:text-3xl font-bold mb-6" style="color: #1f2937;">Pesan Masuk dari Alumni</h2>
          <div class="space-y-4">
      `;
      
      if (pesanData.length === 0) {
        html += `
          <div class="text-center py-16" style="color: #6b7280;">
            <i class="fa fa-inbox text-5xl mb-4" style="display: block;"></i>
            <p class="text-lg">Belum ada pesan masuk</p>
          </div>
        `;
      } else {
        pesanData.forEach((pesan) => {
          const tanggal = pesan.created_at ? new Date(pesan.created_at).toLocaleString('id-ID', {
            day: 'numeric',
            month: 'short',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
          }) : '-';
          
          html += `
            <div class="stat-card p-5">
              <div class="flex justify-between items-start mb-3">
                <div class="flex-1">
                  <div class="flex items-center gap-2 mb-1">
                    <h3 class="font-bold text-base" style="color: #1f2937;">${pesan.nama}</h3>
                    <span class="px-2 py-1 rounded text-xs font-semibold" style="background-color: rgba(59, 130, 246, 0.1); color: #3b82f6;">Alumni ${pesan.tahun}</span>
                  </div>
                  <p class="text-xs" style="color: #6b7280;"><i class="fa fa-clock mr-1"></i>${tanggal}</p>
                </div>
                <button class="deletePesanBtn text-sm px-3 py-1 rounded-lg" style="background-color: #fee2e2; color: #dc2626; cursor: pointer;" data-id="${pesan.id}">
                  <i class="fa fa-trash"></i>
                </button>
              </div>
              <div class="p-3 rounded-lg text-sm" style="background-color: #f9fafb; color: #1f2937;">
                ${pesan.pesan}
              </div>
            </div>
          `;
        });
      }
      
      html += `
          </div>
        </div>
      `;
      
      content.innerHTML = html;
      
      document.querySelectorAll('.deletePesanBtn').forEach(btn => {
        btn.addEventListener('click', async (e) => {
          const button = e.currentTarget;
          const id = button.getAttribute('data-id');
          
          button.disabled = true;
          button.innerHTML = '<i class="fa fa-spinner fa-spin"></i>';
          
          const result = await deletePesan(id);
          
          if (result.success) {
            showToast('Pesan berhasil dihapus');
          } else {
            showToast('Gagal menghapus pesan', 'error');
            button.disabled = false;
            button.innerHTML = '<i class="fa fa-trash"></i>';
          }
        });
      });
    }

    function renderFormDaftar(content) {
      content.innerHTML = `
        <div class="content-card max-w-3xl mx-auto">
          <div class="text-center mb-8">
            <div class="inline-flex items-center justify-center w-20 h-20 rounded-full mb-4" style="background-color: rgba(16, 185, 129, 0.1);">
              <i class="fa fa-user-plus text-4xl" style="color: #10b981;"></i>
            </div>
            <h2 class="text-2xl md:text-3xl font-bold mb-2" style="color: #1f2937;">Form Pendataan Alumni</h2>
            <p style="color: #6b7280;">Silakan isi data Anda dengan lengkap dan benar</p>
          </div>
          
          <div class="stat-card p-6 md:p-8">
            <form id="publicAlumniForm">
              <div class="mb-5">
                <label class="block mb-2 font-semibold flex items-center gap-2 text-sm md:text-base" style="color: #1f2937;">
                  <span>Nama Lengkap</span>
                  <span style="color: #ef4444;">*</span>
                </label>
                <input type="text" name="nama" class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none text-sm md:text-base" placeholder="Masukkan nama lengkap" required style="border-color: #e5e7eb;">
              </div>

              <div class="mb-5">
                <label class="block mb-2 font-semibold flex items-center gap-2 text-sm md:text-base" style="color: #1f2937;">
                  <span>Tempat, Tanggal Lahir</span>
                  <span style="color: #ef4444;">*</span>
                </label>
                <input type="text" name="ttl" class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none text-sm md:text-base" placeholder="Contoh: Aikmel, 15 Agustus 2000" required style="border-color: #e5e7eb;">
              </div>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mb-5">
                <div>
                  <label class="block mb-2 font-semibold flex items-center gap-2 text-sm md:text-base" style="color: #1f2937;">
                    <span>Tahun Masuk</span>
                    <span style="color: #ef4444;">*</span>
                  </label>
                  <input type="text" name="tahun_masuk" class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none text-sm md:text-base" placeholder="Contoh: 2018" required style="border-color: #e5e7eb;">
                </div>

                <div>
                  <label class="block mb-2 font-semibold flex items-center gap-2 text-sm md:text-base" style="color: #1f2937;">
                    <span>Tahun Lulus</span>
                    <span style="color: #ef4444;">*</span>
                  </label>
                  <input type="text" name="tahun_lulus" class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none text-sm md:text-base" placeholder="Contoh: 2021" required style="border-color: #e5e7eb;">
                </div>
              </div>

              <div class="mb-5">
                <label class="block mb-2 font-semibold flex items-center gap-2 text-sm md:text-base" style="color: #1f2937;">
                  <span>Jenis Kelamin</span>
                  <span style="color: #ef4444;">*</span>
                </label>
                <select name="jenis_kelamin" class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none text-sm md:text-base" required style="border-color: #e5e7eb;">
                  <option value="">Pilih Jenis Kelamin</option>
                  <option value="Laki-laki">Laki-laki</option>
                  <option value="Perempuan">Perempuan</option>
                </select>
              </div>

              <div class="mb-5">
                <label class="block mb-2 font-semibold flex items-center gap-2 text-sm md:text-base" style="color: #1f2937;">
                  <span>Kelanjutan Pendidikan</span>
                </label>
                <input type="text" name="kelanjutan_pendidikan" class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none text-sm md:text-base" placeholder="Contoh: S1 Universitas Indonesia (Opsional)" style="border-color: #e5e7eb;">
                <p class="text-xs md:text-sm mt-1" style="color: #6b7280;">Kosongkan jika tidak melanjutkan</p>
              </div>

              <div class="mb-6">
                <label class="block mb-2 font-semibold flex items-center gap-2 text-sm md:text-base" style="color: #1f2937;">
                  <span>Tugas/Pekerjaan Saat Ini</span>
                </label>
                <input type="text" name="tugas" class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none text-sm md:text-base" placeholder="Contoh: Mengajar di Pontren Jamaluddin (Opsional)" style="border-color: #e5e7eb;">
                <p class="text-xs md:text-sm mt-1" style="color: #6b7280;">Kosongkan jika tidak/belum bekerja</p>
              </div>

              <div class="flex gap-3">
                <button type="submit" class="btn-modern flex-1 py-3 md:py-4 px-6 font-semibold text-base md:text-lg flex items-center justify-center gap-2" style="background-color: #10b981; color: #ffffff;">
                  <i class="fa fa-paper-plane"></i>
                  <span>Kirim Data</span>
                </button>
              </div>

              <div id="formMessage" class="mt-4 p-4 rounded-lg text-center font-semibold hidden text-sm md:text-base"></div>
            </form>
          </div>
        </div>
      `;

      const form = document.getElementById('publicAlumniForm');
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const submitBtn = e.target.querySelector('button[type="submit"]');
        const originalContent = submitBtn.innerHTML;
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i>Mengirim...';
        
        const formData = new FormData(e.target);
        const newAlumni = {
          nama: formData.get('nama'),
          ttl: formData.get('ttl'),
          tahun_masuk: formData.get('tahun_masuk'),
          tahun_lulus: formData.get('tahun_lulus'),
          jenis_kelamin: formData.get('jenis_kelamin'),
          kelanjutan_pendidikan: formData.get('kelanjutan_pendidikan') || '-',
          iuran_status: 'Belum Bayar',
          tugas: formData.get('tugas') || '-',
          created_at: new Date().toISOString()
        };
        
        const result = await addAlumni(newAlumni);
        
        const msgEl = document.getElementById('formMessage');
        if (result.success) {
          msgEl.innerHTML = '<i class="fa fa-check-circle mr-2"></i>Data berhasil dikirim! Terima kasih telah mendaftar.';
          msgEl.style.backgroundColor = '#d1fae5';
          msgEl.style.color = '#065f46';
          msgEl.classList.remove('hidden');
          e.target.reset();
          showToast('âœ… Data berhasil tersimpan!');
          setTimeout(() => {
            msgEl.classList.add('hidden');
          }, 5000);
        } else {
          msgEl.innerHTML = '<i class="fa fa-exclamation-circle mr-2"></i>Gagal mengirim data. Silakan coba lagi.';
          msgEl.style.backgroundColor = '#fee2e2';
          msgEl.style.color = '#dc2626';
          msgEl.classList.remove('hidden');
        }
        
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalContent;
      });
    }

    // ========================================
    // MODAL FUNCTIONS
    // ========================================

    function showAlumniForm() {
      const modal = document.createElement('div');
      modal.className = 'modal-backdrop fixed inset-0 flex items-center justify-center';
      modal.style.backgroundColor = 'rgba(0,0,0,0.5)';
      modal.style.zIndex = '1000';
      modal.innerHTML = `
        <div class="rounded-2xl shadow-2xl p-6 md:p-8 max-w-md w-full max-h-screen overflow-y-auto mx-4" style="background-color: #ffffff;">
          <div class="text-center mb-6">
            <div class="inline-flex items-center justify-center w-16 h-16 rounded-full mb-4" style="background-color: rgba(59, 130, 246, 0.1);">
              <i class="fa fa-user-plus text-3xl" style="color: #3b82f6;"></i>
            </div>
            <h3 class="text-xl md:text-2xl font-bold" style="color: #1f2937;">Tambah Alumni</h3>
          </div>
          <form id="adminAlumniForm">
            <div class="mb-4">
              <label class="block mb-2 font-semibold flex items-center gap-2 text-sm md:text-base" style="color: #1f2937;">
                <i class="fa fa-user"></i>
                <span>Nama</span>
              </label>
              <input type="text" name="nama" class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none text-sm md:text-base" required style="border-color: #e5e7eb;">
            </div>
            <div class="mb-4">
              <label class="block mb-2 font-semibold flex items-center gap-2 text-sm md:text-base" style="color: #1f2937;">
                <i class="fa fa-birthday-cake"></i>
                <span>Tempat, Tanggal Lahir</span>
              </label>
              <input type="text" name="ttl" class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none text-sm md:text-base" required style="border-color: #e5e7eb;">
            </div>
            <div class="mb-4">
              <label class="block mb-2 font-semibold flex items-center gap-2 text-sm md:text-base" style="color: #1f2937;">
                <i class="fa fa-calendar-alt"></i>
                <span>Tahun Masuk</span>
              </label>
              <input type="text" name="tahun_masuk" class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none text-sm md:text-base" required style="border-color: #e5e7eb;">
            </div>
            <div class="mb-4">
              <label class="block mb-2 font-semibold flex items-center gap-2 text-sm md:text-base" style="color: #1f2937;">
                <i class="fa fa-calendar-check"></i>
                <span>Tahun Lulus</span>
              </label>
              <input type="text" name="tahun_lulus" class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none text-sm md:text-base" required style="border-color: #e5e7eb;">
            </div>
            <div class="mb-4">
              <label class="block mb-2 font-semibold flex items-center gap-2 text-sm md:text-base" style="color: #1f2937;">
                <i class="fa fa-venus-mars"></i>
                <span>Jenis Kelamin</span>
              </label>
              <select name="jenis_kelamin" class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none text-sm md:text-base" required style="border-color: #e5e7eb;">
                <option value="">Pilih</option>
                <option value="Laki-laki">Laki-laki</option>
                <option value="Perempuan">Perempuan</option>
              </select>
            </div>
            <div class="mb-4">
              <label class="block mb-2 font-semibold flex items-center gap-2 text-sm md:text-base" style="color: #1f2937;">
                <i class="fa fa-university"></i>
                <span>Kelanjutan Pendidikan</span>
              </label>
              <input type="text" name="kelanjutan_pendidikan" class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none text-sm md:text-base" style="border-color: #e5e7eb;">
            </div>
            <div class="mb-4">
              <label class="block mb-2 font-semibold flex items-center gap-2 text-sm md:text-base" style="color: #1f2937;">
                <i class="fa fa-money-bill-wave"></i>
                <span>Status Iuran</span>
              </label>
              <select name="iuran_status" class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none text-sm md:text-base" required style="border-color: #e5e7eb;">
                <option value="Belum Bayar">Belum Bayar</option>
                <option value="Lunas">Lunas</option>
              </select>
            </div>
            <div class="mb-6">
              <label class="block mb-2 font-semibold flex items-center gap-2 text-sm md:text-base" style="color: #1f2937;">
                <i class="fa fa-tasks"></i>
                <span>Tugas</span>
              </label>
              <input type="text" name="tugas" class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none text-sm md:text-base" style="border-color: #e5e7eb;">
            </div>
            <div class="flex gap-3">
              <button type="submit" class="btn-modern flex-1 py-3 px-4 font-semibold flex items-center justify-center gap-2 text-sm md:text-base" style="background-color: #3b82f6; color: #ffffff;">
                <i class="fa fa-save"></i>
                <span>Simpan</span>
              </button>
              <button type="button" class="btn-modern flex-1 py-3 px-4 font-semibold closeModal text-sm md:text-base" style="background-color: #6b7280; color: #ffffff;">
                <i class="fa fa-times mr-2"></i>Batal
              </button>
            </div>
          </form>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      modal.querySelector('.closeModal').addEventListener('click', () => {
        modal.remove();
      });
      
      modal.querySelector('#adminAlumniForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const submitBtn = e.target.querySelector('button[type="submit"]');
        const originalContent = submitBtn.innerHTML;
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fa fa-spinner fa-spin"></i> Menyimpan...';
        
        const formData = new FormData(e.target);
        const newAlumni = {
          nama: formData.get('nama'),
          ttl: formData.get('ttl'),
          tahun_masuk: formData.get('tahun_masuk'),
          tahun_lulus: formData.get('tahun_lulus'),
          jenis_kelamin: formData.get('jenis_kelamin'),
          kelanjutan_pendidikan: formData.get('kelanjutan_pendidikan') || '-',
          iuran_status: formData.get('iuran_status'),
          tugas: formData.get('tugas') || '-',
          created_at: new Date().toISOString()
        };
        
        const result = await addAlumni(newAlumni);
        
        if (result.success) {
          showToast('âœ… Alumni berhasil ditambahkan');
          modal.remove();
        } else {
          showToast('âŒ Gagal menambahkan alumni', 'error');
          submitBtn.disabled = false;
          submitBtn.innerHTML = originalContent;
        }
      });
    }

    // ========================================
    // EVENT LISTENERS
    // ========================================

    // Navigation
    document.querySelectorAll('.menu-item[data-page]').forEach(item => {
      item.addEventListener('click', (e) => {
        e.preventDefault();
        const page = e.currentTarget.getAttribute('data-page');
        loadPage(page);
      });
    });

    // Floating Chat Button
    document.getElementById('floatingChatBtn').addEventListener('click', () => {
      document.getElementById('chatModal').classList.toggle('show');
    });

    document.getElementById('closeChatModal').addEventListener('click', () => {
      document.getElementById('chatModal').classList.remove('show');
    });

    document.getElementById('chatForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      const originalContent = submitBtn.innerHTML;
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i>Mengirim...';
      
      const formData = new FormData(e.target);
      const newPesan = {
        nama: formData.get('nama'),
        tahun: formData.get('tahun'),
        pesan: formData.get('pesan'),
        created_at: new Date().toISOString()
      };
      
      const result = await addPesan(newPesan);
      
      if (result.success) {
        showToast('âœ… Pesan berhasil dikirim! Terima kasih atas sarannya.');
        e.target.reset();
        document.getElementById('chatModal').classList.remove('show');
      } else {
        showToast('âŒ Gagal mengirim pesan. Silakan coba lagi.', 'error');
      }
      
      submitBtn.disabled = false;
      submitBtn.innerHTML = originalContent;
    });

    // Login
    document.getElementById('loginBtn').addEventListener('click', (e) => {
      e.preventDefault();
      if (isAdmin) {
        isAdmin = false;
        document.getElementById('menuPesanMasuk').style.display = 'none';
        e.currentTarget.innerHTML = '<i class="fa fa-lock"></i><span>Login Admin</span>';
        showToast('âœ… Berhasil logout');
        loadPage(currentPage);
      } else {
        document.getElementById('loginModal').classList.remove('hidden');
      }
    });

    document.getElementById('cancelLogin').addEventListener('click', () => {
      document.getElementById('loginModal').classList.add('hidden');
      document.getElementById('loginError').classList.add('hidden');
      document.getElementById('loginForm').reset();
    });

    document.getElementById('loginForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      
      if (username === 'admin' && password === 'admin') {
        isAdmin = true;
        document.getElementById('menuPesanMasuk').style.display = 'flex';
        document.getElementById('loginBtn').innerHTML = '<i class="fa fa-sign-out-alt"></i><span>Logout</span>';
        document.getElementById('loginModal').classList.add('hidden');
        document.getElementById('loginError').classList.add('hidden');
        document.getElementById('loginForm').reset();
        showToast('Login berhasil!');
        loadPage(currentPage);
      } else {
        const errorEl = document.getElementById('loginError');
        errorEl.innerHTML = '<i class="fa fa-exclamation-circle mr-2"></i>Username atau password salah!';
        errorEl.classList.remove('hidden');
      }
    });

    // ========================================
    // INITIALIZATION
    // ========================================
    
    // Start listening to Firebase
    subscribeToAlumni();
    subscribeToPesan();
    
    // Load initial page
    loadPage('beranda');
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a10bed7224cfd0a',t:'MTc2MzU2NjE5MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
